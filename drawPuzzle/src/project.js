__require=function t(e,i,n){function o(a,s){if(!i[a]){if(!e[a]){var c=a.split("/");if(c=c[c.length-1],!e[c]){var _="function"==typeof __require&&__require;if(!s&&_)return _(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+a+"'")}}var h=i[a]={exports:{}};e[a][0].call(h.exports,function(t){return o(e[a][1][t]||t)},h,h.exports,t,e,i,n)}return i[a].exports}for(var r="function"==typeof __require&&__require,a=0;a<n.length;a++)o(n[a]);return o}({CommonEnum:[function(t,e,i){"use strict";cc._RF.push(e,"ebd65ilRd5AS5yZr46iX7LL","CommonEnum"),Object.defineProperty(i,"__esModule",{value:!0});var n=cc._decorator,o=n.ccclass,r=(n.property,function(){function t(t){this._line=e.INVALID_LINE,this._gridNode=t}var e;return e=t,Object.defineProperty(t.prototype,"line",{get:function(){return this._line},set:function(t){this._line=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gridNode",{get:function(){return this._gridNode},set:function(t){this._gridNode=t},enumerable:!0,configurable:!0}),t.prototype.pointValid=function(){return this._line==e.INVALID_LINE},t.INVALID_LINE=-1,t=e=__decorate([o],t)}());i.default=r;var a=function(){function t(){}return t.DRAWING=1,t.DELETE_LINE=2,t.PAUSE=3,t=__decorate([o],t)}();i.GAME_STATE=a,cc._RF.pop()},{}],Game:[function(t,e,i){"use strict";cc._RF.push(e,"5a103Ie2VZJXKMtf3TR0agT","Game"),Object.defineProperty(i,"__esModule",{value:!0});var n=t("./Common/CommonEnum"),o=t("./Common/CommonEnum"),r=cc._decorator,a=r.ccclass,s=r.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lbState=null,e.continer=null,e.bgGrid=null,e.linePrefab=null,e.row_grid_num=15,e.vol_grid_num=15,e._lineOBjects={},e._curDrawingLineNode=null,e._moveIdx=-1,e._arrPointsData=[],e._gameState=0,e}return __extends(e,t),e.prototype.start=function(){for(var t=0;t<this.row_grid_num;++t)for(var e=0;e<this.vol_grid_num;++e){var i=cc.instantiate(this.bgGrid);i.getChildByName("num").getComponent(cc.Label).string=(t*this.row_grid_num+e).toString(),this._arrPointsData.push(new n.default(i)),this.continer.addChild(i),(t+e)%2==1&&(i.color=cc.Color.BLUE)}this.continer.on(cc.Node.EventType.TOUCH_START,this.onTouch,this),this.continer.on(cc.Node.EventType.TOUCH_MOVE,this.onTouch,this),this.continer.on(cc.Node.EventType.TOUCH_END,this.onTouch,this),this.continer.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouch,this),this.switchState(o.GAME_STATE.DRAWING)},e.prototype.onTouch=function(t){var e=t.type,i=t.touch._point,n=this.continer.convertToNodeSpace(i);if(!(n.x<0||n.y<0||n.x>this.continer.width||n.y>this.continer.height)){var r=Math.floor(n.x/40),a=Math.floor(n.y/40)*this.row_grid_num+r,s=this._arrPointsData[a].gridNode;"touchstart"==e?(console.log(a,s.x,s.y),this._moveIdx=a,this._gameState==o.GAME_STATE.DRAWING?this.drawLine(this._moveIdx):this._gameState==o.GAME_STATE.DELETE_LINE&&this.deleteLine(this._moveIdx)):"touchmove"==e?this._gameState==o.GAME_STATE.DRAWING&&this._curDrawingLineNode&&a!=this._moveIdx&&(this._moveIdx=a,this._curDrawingLineNode.getComponent("LineObject").setPoint(a)):"touchend"!=e&&"touchcancel"!=e||(this._curDrawingLineNode=null,this._moveIdx=-1)}},e.prototype.touchGrid=function(t){this.drawLine(t)},e.prototype.drawLine=function(t){if(!this._arrPointsData[t].pointValid()){var e=this._arrPointsData[t].line;return this._curDrawingLineNode=this._lineOBjects[e],-1}return console.log("\u7ed8\u5236\u4e00\u6761\u65b0\u7ebf",t,this._arrPointsData[t].pointValid()),this._curDrawingLineNode=cc.instantiate(this.linePrefab),this._curDrawingLineNode.getComponent("LineObject").setContainer(this.continer,this._arrPointsData),this._curDrawingLineNode.getComponent("LineObject").setPoint(t),this.node.addChild(this._curDrawingLineNode),this._lineOBjects[t]=this._curDrawingLineNode,0},e.prototype.deleteLine=function(t){var e=this._arrPointsData[t].line;e!=n.default.INVALID_LINE&&(console.log("lineIdx",e,this._lineOBjects[e]),this._lineOBjects[e].getComponent("LineObject").deleteLine(),this._lineOBjects[e]=null)},e.prototype.btnSwitchStateClick=function(){var t=0;this._gameState==o.GAME_STATE.DRAWING?t=o.GAME_STATE.DELETE_LINE:this._gameState==o.GAME_STATE.DELETE_LINE&&(t=o.GAME_STATE.DRAWING),this.switchState(t)},e.prototype.switchState=function(t){this._gameState=t,this._gameState==o.GAME_STATE.DRAWING?this.lbState.string="DRAWING":this._gameState==o.GAME_STATE.DELETE_LINE&&(this.lbState.string="DELETING")},e.prototype.dispose=function(){this._lineOBjects={},this._curDrawingLineNode=null},__decorate([s(cc.Label)],e.prototype,"lbState",void 0),__decorate([s(cc.Node)],e.prototype,"continer",void 0),__decorate([s(cc.Prefab)],e.prototype,"bgGrid",void 0),__decorate([s(cc.Prefab)],e.prototype,"linePrefab",void 0),__decorate([s],e.prototype,"row_grid_num",void 0),__decorate([s],e.prototype,"vol_grid_num",void 0),e=__decorate([a],e)}(cc.Component);i.default=c,cc._RF.pop()},{"./Common/CommonEnum":"CommonEnum"}],LineObject:[function(t,e,i){"use strict";cc._RF.push(e,"8f27aP8ZGdFNIIL3YrDTO51","LineObject"),Object.defineProperty(i,"__esModule",{value:!0});var n=t("./Common/CommonEnum"),o=cc._decorator,r=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.lineUnit=null,e._containNode=null,e._arrPointsData=[],e._pointsStack=[],e._startPointIdx=-1,e}return __extends(e,t),e.prototype.start=function(){},e.prototype.setContainer=function(t,e){this._containNode=t,this.node.width=this._containNode.width,this.node.height=this._containNode.height,this._arrPointsData=e},e.prototype.setPoint=function(t){var e=this.findPointIndex(t);if(-1!=e)return console.log("findPoint",e),void(e==this._pointsStack.length-2&&this.popPoint());var i=this._pointsStack.length;i>=1?this.drawUnitLine(this._pointsStack[i-1],t)&&this.pushPoint(t):(this._startPointIdx=t,this.pushPoint(t))},e.prototype.findPointIndex=function(t){return this._pointsStack.indexOf(t)},e.prototype.pushPoint=function(t){console.log("push",this._startPointIdx,t),this._pointsStack.push(t),this._arrPointsData[t].line=this._startPointIdx},e.prototype.popPoint=function(){var t=this._pointsStack.pop();this._arrPointsData[t].line=n.default.INVALID_LINE,this.node.getChildByName("idx"+t).removeFromParent()},e.prototype.deleteLine=function(){var t=this;this._pointsStack.forEach(function(e){t._arrPointsData[e].line=n.default.INVALID_LINE}),this.node.destroy()},e.prototype.drawUnitLine=function(t,e){console.log("drawUnitLine",t,e);var i=Math.floor(t/15),n=t%15,o=Math.floor(e/15),r=e%15,a=this._arrPointsData[t].gridNode,s=0,c=0,_=0,h=0;if(r==n?o==i+1?(s=1,c=90,_=a.x,h=a.y+a.height/2):o==i-1&&(s=2,c=90,_=a.x,h=a.y-a.height/2):o==i&&(r==n-1?(s=3,c=0,_=a.x-a.width/2,h=a.y):r==n+1&&(s=4,c=0,_=a.x+a.width/2,h=a.y)),console.log("dir",s),!(s>=1&&s<=4))return!1;console.log(i,n,o,r,s,c);var d=cc.instantiate(this.lineUnit);return d.rotation=c,d.x=_,d.y=h,d.name="idx"+e,this.node.addChild(d),!0},e.prototype.dispose=function(){this._pointsStack=[],this._containNode=null,this._arrPointsData=null,this._startPointIdx=-1},__decorate([a(cc.Label)],e.prototype,"label",void 0),__decorate([a(cc.Prefab)],e.prototype,"lineUnit",void 0),e=__decorate([r],e)}(cc.Component);i.default=s,cc._RF.pop()},{"./Common/CommonEnum":"CommonEnum"}]},{},["CommonEnum","Game","LineObject"]);