__require=function t(e,n,i){function o(s,c){if(!n[s]){if(!e[s]){var a=s.split("/");if(a=a[a.length-1],!e[a]){var h="function"==typeof __require&&__require;if(!c&&h)return h(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+s+"'")}}var _=n[s]={exports:{}};e[s][0].call(_.exports,function(t){return o(e[s][1][t]||t)},_,_.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<i.length;s++)o(i[s]);return o}({CommonEnum:[function(t,e,n){"use strict";cc._RF.push(e,"ebd65ilRd5AS5yZr46iX7LL","CommonEnum"),Object.defineProperty(n,"__esModule",{value:!0});var i=cc._decorator,o=i.ccclass,r=(i.property,function(){function t(t){this._line=e.INVALID_LINE,this._gridNode=t}var e;return e=t,Object.defineProperty(t.prototype,"line",{get:function(){return this._line},set:function(t){this._line=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gridNode",{get:function(){return this._gridNode},set:function(t){this._gridNode=t},enumerable:!0,configurable:!0}),t.prototype.pointValid=function(){return this._line==e.INVALID_LINE},t.INVALID_LINE=-1,t=e=__decorate([o],t)}());n.default=r;var s=function(){function t(){}return t.DRAWING=1,t.DELETE_LINE=2,t.PAUSE=3,t=__decorate([o],t)}();n.GAME_STATE=s,cc._RF.pop()},{}],Game:[function(t,e,n){"use strict";cc._RF.push(e,"5a103Ie2VZJXKMtf3TR0agT","Game"),Object.defineProperty(n,"__esModule",{value:!0});var i=t("./Common/CommonEnum"),o=t("./Common/CommonEnum"),r=cc._decorator,s=r.ccclass,c=r.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lbState=null,e.continer=null,e.bgGrid=null,e.linePrefab=null,e.row_grid_num=15,e.vol_grid_num=15,e._lineOBjects={},e._curDrawingLineNode=null,e._moveIdx=-1,e._arrPointsData=[],e._gameState=0,e}return __extends(e,t),e.prototype.start=function(){for(var t=0;t<this.row_grid_num;++t)for(var e=0;e<this.vol_grid_num;++e){var n=cc.instantiate(this.bgGrid);this._arrPointsData.push(new i.default(n)),this.continer.addChild(n),(t+e)%2==1&&(n.color=cc.Color.BLUE)}this.continer.on(cc.Node.EventType.TOUCH_START,this.onTouch,this),this.continer.on(cc.Node.EventType.TOUCH_MOVE,this.onTouch,this),this.continer.on(cc.Node.EventType.TOUCH_END,this.onTouch,this),this.continer.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouch,this),this.switchState(o.GAME_STATE.DRAWING)},e.prototype.onTouch=function(t){var e=t.type,n=t.touch._point,i=this.continer.convertToNodeSpace(n);if(!(i.x<0||i.y<0||i.x>this.continer.width||i.y>this.continer.height)){var r=Math.floor(i.x/40),s=Math.floor(i.y/40)*this.row_grid_num+r,c=this._arrPointsData[s].gridNode;"touchstart"==e?(console.log(s,c.x,c.y),this._moveIdx=s,this._gameState==o.GAME_STATE.DRAWING?this.drawLine(this._moveIdx):this._gameState==o.GAME_STATE.DELETE_LINE&&this.deleteLine(this._moveIdx)):"touchmove"==e?this._gameState==o.GAME_STATE.DRAWING&&this._curDrawingLineNode&&s!=this._moveIdx&&(this._moveIdx=s,this._curDrawingLineNode.getComponent("LineObject").setPoint(s)):"touchend"!=e&&"touchcancel"!=e||(this.checkCurrentLine(),this._curDrawingLineNode=null,this._moveIdx=-1)}},e.prototype.touchGrid=function(t){this.drawLine(t)},e.prototype.drawLine=function(t){if(!this._arrPointsData[t].pointValid()){var e=this._arrPointsData[t].line;return this._curDrawingLineNode=this._lineOBjects[e],-1}return console.log("\u7ed8\u5236\u4e00\u6761\u65b0\u7ebf",t,this._arrPointsData[t].pointValid()),this._curDrawingLineNode=cc.instantiate(this.linePrefab),this._curDrawingLineNode.getComponent("LineObject").setContainer(this.continer,this._arrPointsData),this._curDrawingLineNode.getComponent("LineObject").setPoint(t),this.node.addChild(this._curDrawingLineNode),this._lineOBjects[t]=this._curDrawingLineNode,0},e.prototype.checkCurrentLine=function(){if(1==this._curDrawingLineNode.getComponent("LineObject").getPointCount()){var t=this._curDrawingLineNode.getComponent("LineObject").getLineIndex();this._curDrawingLineNode.getComponent("LineObject").deleteLine(),this._lineOBjects[t]=null}},e.prototype.deleteLine=function(t){var e=this._arrPointsData[t].line;e!=i.default.INVALID_LINE&&(console.log("lineIdx",e,this._lineOBjects[e]),this._lineOBjects[e].getComponent("LineObject").deleteLine(),this._lineOBjects[e]=null)},e.prototype.btnSwitchStateClick=function(){var t=0;this._gameState==o.GAME_STATE.DRAWING?t=o.GAME_STATE.DELETE_LINE:this._gameState==o.GAME_STATE.DELETE_LINE&&(t=o.GAME_STATE.DRAWING),this.switchState(t)},e.prototype.switchState=function(t){this._gameState=t,this._gameState==o.GAME_STATE.DRAWING?this.lbState.string="DRAWING":this._gameState==o.GAME_STATE.DELETE_LINE&&(this.lbState.string="DELETING")},e.prototype.dispose=function(){this._lineOBjects={},this._curDrawingLineNode=null},__decorate([c(cc.Label)],e.prototype,"lbState",void 0),__decorate([c(cc.Node)],e.prototype,"continer",void 0),__decorate([c(cc.Prefab)],e.prototype,"bgGrid",void 0),__decorate([c(cc.Prefab)],e.prototype,"linePrefab",void 0),__decorate([c],e.prototype,"row_grid_num",void 0),__decorate([c],e.prototype,"vol_grid_num",void 0),e=__decorate([s],e)}(cc.Component);n.default=a,cc._RF.pop()},{"./Common/CommonEnum":"CommonEnum"}],LineObject:[function(t,e,n){"use strict";cc._RF.push(e,"8f27aP8ZGdFNIIL3YrDTO51","LineObject"),Object.defineProperty(n,"__esModule",{value:!0});var i=t("./Common/CommonEnum"),o=cc._decorator,r=o.ccclass,s=o.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.lineUnit=null,e._containNode=null,e._arrPointsData=[],e._pointsStack=[],e._startPointIdx=-1,e}return __extends(e,t),e.prototype.start=function(){},e.prototype.setContainer=function(t,e){this._containNode=t,this.node.width=this._containNode.width,this.node.height=this._containNode.height,this._arrPointsData=e},e.prototype.setPoint=function(t){var e=this.findPointIndex(t);if(-1!=e)return console.log("findPoint",e,this._pointsStack.length),void(e==this._pointsStack.length-2&&this.popPoint());var n=this._pointsStack.length;n>=1?this.drawUnitLine(this._pointsStack[n-1],t)&&this.pushPoint(t):(this._startPointIdx=t,this.pushPoint(t))},e.prototype.findPointIndex=function(t){return this._pointsStack.indexOf(t)},e.prototype.pushPoint=function(t){console.log("push",this._startPointIdx,t),this._pointsStack.push(t),this._arrPointsData[t].line=this._startPointIdx},e.prototype.popPoint=function(){var t=this._pointsStack.pop();this._arrPointsData[t].line=i.default.INVALID_LINE,this.node.getChildByName("idx"+t).removeFromParent()},e.prototype.deleteLine=function(){var t=this;this._pointsStack.forEach(function(e){t._arrPointsData[e].line=i.default.INVALID_LINE}),this.node.destroy(),console.log("\u5220\u9664\u4e86\u4e00\u6761\u7ebf",this._startPointIdx)},e.prototype.getPointCount=function(){return this._pointsStack.length},e.prototype.getLineIndex=function(){return this._startPointIdx},e.prototype.drawUnitLine=function(t,e){console.log("drawUnitLine",t,e);var n=Math.floor(t/15),i=t%15,o=Math.floor(e/15),r=e%15,s=this._arrPointsData[t].gridNode,c=0,a=0,h=0,_=0;if(r==i?o==n+1?(c=1,a=90,h=s.x,_=s.y+s.height/2):o==n-1&&(c=2,a=90,h=s.x,_=s.y-s.height/2):o==n&&(r==i-1?(c=3,a=0,h=s.x-s.width/2,_=s.y):r==i+1&&(c=4,a=0,h=s.x+s.width/2,_=s.y)),console.log("dir",c),!(c>=1&&c<=4))return!1;console.log(n,i,o,r,c,a);var u=cc.instantiate(this.lineUnit);return u.rotation=a,u.x=h,u.y=_,u.name="idx"+e,this.node.addChild(u),!0},e.prototype.dispose=function(){this._pointsStack=[],this._containNode=null,this._arrPointsData=null,this._startPointIdx=-1},__decorate([s(cc.Label)],e.prototype,"label",void 0),__decorate([s(cc.Prefab)],e.prototype,"lineUnit",void 0),e=__decorate([r],e)}(cc.Component);n.default=c,cc._RF.pop()},{"./Common/CommonEnum":"CommonEnum"}]},{},["CommonEnum","Game","LineObject"]);