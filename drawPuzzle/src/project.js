__require=function t(e,o,n){function i(c,a){if(!o[c]){if(!e[c]){var s=c.split("/");if(s=s[s.length-1],!e[s]){var _="function"==typeof __require&&__require;if(!a&&_)return _(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+c+"'")}}var h=o[c]={exports:{}};e[c][0].call(h.exports,function(t){return i(e[c][1][t]||t)},h,h.exports,t,e,o,n)}return o[c].exports}for(var r="function"==typeof __require&&__require,c=0;c<n.length;c++)i(n[c]);return i}({CommonEnum:[function(t,e,o){"use strict";cc._RF.push(e,"ebd65ilRd5AS5yZr46iX7LL","CommonEnum"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,i=n.ccclass,r=(n.property,function(){function t(t){this._line=e.INVALID_LINE,this._gridNode=t}var e;return e=t,Object.defineProperty(t.prototype,"line",{get:function(){return this._line},set:function(t){this._line=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gridNode",{get:function(){return this._gridNode},set:function(t){this._gridNode=t},enumerable:!0,configurable:!0}),t.prototype.pointValid=function(){return this._line==e.INVALID_LINE},t.INVALID_LINE=-1,t=e=__decorate([i],t)}());o.default=r;var c=function(){function t(){}return t.DRAWING=1,t.DELETE_LINE=2,t.PAUSE=3,t=__decorate([i],t)}();o.GAME_STATE=c,cc._RF.pop()},{}],Game:[function(t,e,o){"use strict";cc._RF.push(e,"5a103Ie2VZJXKMtf3TR0agT","Game"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./Common/CommonEnum"),i=t("./Common/CommonEnum"),r=cc._decorator,c=r.ccclass,a=r.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lbState=null,e.continer=null,e.bgGrid=null,e.linePrefab=null,e.row_grid_num=15,e.vol_grid_num=15,e._lineOBjects={},e._curDrawingLineNode=null,e._moveIdx=-1,e._arrPointsData=[],e._gameState=0,e}return __extends(e,t),e.prototype.start=function(){for(var t=0;t<this.row_grid_num;++t)for(var e=0;e<this.vol_grid_num;++e){var o=cc.instantiate(this.bgGrid);o.getChildByName("num").getComponent(cc.Label).string=(t*this.row_grid_num+e).toString(),this._arrPointsData.push(new n.default(o)),this.continer.addChild(o),(t+e)%2==1&&(o.color=cc.Color.BLUE)}this.continer.on(cc.Node.EventType.TOUCH_START,this.onTouch,this),this.continer.on(cc.Node.EventType.TOUCH_MOVE,this.onTouch,this),this.continer.on(cc.Node.EventType.TOUCH_END,this.onTouch,this),this.continer.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouch,this),this.switchState(i.GAME_STATE.DRAWING)},e.prototype.onTouch=function(t){var e=t.type,o=t.touch._point,n=this.continer.convertToNodeSpace(o);if(!(n.x<0||n.y<0||n.x>this.continer.width||n.y>this.continer.height)){var r=Math.floor(n.x/40),c=Math.floor(n.y/40)*this.row_grid_num+r;console.log("idx",c);var a=this._arrPointsData[c].gridNode;"touchstart"==e?(console.log(c,a.x,a.y),this._moveIdx=c,this._gameState==i.GAME_STATE.DRAWING?this.drawLine(this._moveIdx):this._gameState==i.GAME_STATE.DELETE_LINE&&this.deleteLine(this._moveIdx)):"touchmove"==e?this._gameState==i.GAME_STATE.DRAWING&&c!=this._moveIdx&&(this._moveIdx=c,this._curDrawingLineNode.getComponent("LineObject").setPoint(c)):"touchend"!=e&&"touchcancel"!=e||(this._curDrawingLineNode=null,this._moveIdx=-1)}},e.prototype.touchGrid=function(t){this.drawLine(t)},e.prototype.drawLine=function(t){console.log("\u7ed8\u5236\u4e00\u6761\u65b0\u7ebf",t),this._curDrawingLineNode=cc.instantiate(this.linePrefab),this._curDrawingLineNode.getComponent("LineObject").setContainer(this.continer,this._arrPointsData),this._curDrawingLineNode.getComponent("LineObject").setPoint(t),this.node.addChild(this._curDrawingLineNode),this._lineOBjects[t]=this._curDrawingLineNode},e.prototype.deleteLine=function(t){var e=this._arrPointsData[t].line;e!=n.default.INVALID_LINE&&(console.log("lineIdx",e,this._lineOBjects[e]),this._lineOBjects[e].getComponent("LineObject").deleteLine(),this._lineOBjects[e]=null)},e.prototype.btnSwitchStateClick=function(){var t=0;this._gameState==i.GAME_STATE.DRAWING?t=i.GAME_STATE.DELETE_LINE:this._gameState==i.GAME_STATE.DELETE_LINE&&(t=i.GAME_STATE.DRAWING),this.switchState(t)},e.prototype.switchState=function(t){this._gameState=t,this._gameState==i.GAME_STATE.DRAWING?this.lbState.string="DRAWING":this._gameState==i.GAME_STATE.DELETE_LINE&&(this.lbState.string="DELETING")},e.prototype.dispose=function(){this._lineOBjects={},this._curDrawingLineNode=null},__decorate([a(cc.Label)],e.prototype,"lbState",void 0),__decorate([a(cc.Node)],e.prototype,"continer",void 0),__decorate([a(cc.Prefab)],e.prototype,"bgGrid",void 0),__decorate([a(cc.Prefab)],e.prototype,"linePrefab",void 0),__decorate([a],e.prototype,"row_grid_num",void 0),__decorate([a],e.prototype,"vol_grid_num",void 0),e=__decorate([c],e)}(cc.Component);o.default=s,cc._RF.pop()},{"./Common/CommonEnum":"CommonEnum"}],LineObject:[function(t,e,o){"use strict";cc._RF.push(e,"8f27aP8ZGdFNIIL3YrDTO51","LineObject"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./Common/CommonEnum"),i=cc._decorator,r=i.ccclass,c=i.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.lineUnit=null,e.text="hello",e._containNode=null,e._arrPointsData=[],e._pointsStack=[],e._startPointIdx=-1,e}return __extends(e,t),e.prototype.start=function(){},e.prototype.setContainer=function(t,e){this._containNode=t,this.node.width=this._containNode.width,this.node.height=this._containNode.height,this._arrPointsData=e},e.prototype.setPoint=function(t){if(console.log("setPoint",t),this._arrPointsData[t].pointValid()){var e=this._pointsStack.length;if(e>=1)this.drawUnitLine(this._pointsStack[e-1],t)&&this.pushPoint(t);else this.pushPoint(t),this._startPointIdx=t}else console.log("\u5df2\u7ecf\u7528\u8fc7\u4e86",t)},e.prototype.pushPoint=function(t){this._pointsStack.push(t),this._arrPointsData[t].line=this._startPointIdx},e.prototype.deleteLine=function(){var t=this;this._pointsStack.forEach(function(e){t._arrPointsData[e].line=n.default.INVALID_LINE}),this.node.destroy()},e.prototype.drawUnitLine=function(t,e){console.log("drawUnitLine",t,e);var o=Math.floor(t/15),n=t%15,i=Math.floor(e/15),r=e%15,c=this._arrPointsData[t].gridNode,a=0,s=0,_=0,h=0;if(r==n?i==o+1?(a=1,s=90,_=c.x,h=c.y+c.height/2):i==o-1&&(a=2,s=90,_=c.x,h=c.y-c.height/2):i==o&&(r==n-1?(a=3,s=0,_=c.x-c.width/2,h=c.y):r==n+1&&(a=4,s=0,_=c.x+c.width/2,h=c.y)),console.log("dir",a),!(a>=1&&a<=4))return!1;console.log(o,n,i,r,a,s);var d=cc.instantiate(this.lineUnit);return d.rotation=s,d.x=_,d.y=h,this.node.addChild(d),!0},e.prototype.dispose=function(){this._pointsStack=[],this._containNode=null,this._arrPointsData=null,this._startPointIdx=-1},__decorate([c(cc.Label)],e.prototype,"label",void 0),__decorate([c(cc.Prefab)],e.prototype,"lineUnit",void 0),__decorate([c],e.prototype,"text",void 0),e=__decorate([r],e)}(cc.Component);o.default=a,cc._RF.pop()},{"./Common/CommonEnum":"CommonEnum"}]},{},["CommonEnum","Game","LineObject"]);